part of this code was found in internet blogs ...
(C)opyright is currently unknown - 
needs to be checked or rewritten.

Updated by Grigori Fursin (changes are are under CK copyright/license)